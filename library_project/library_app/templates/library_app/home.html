{% extends 'library_app/base.html' %}
{% load static %}

{% block title %}Главная - Библиотечная система{% endblock %}

{% block extra_css %}
<style>


/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, #447ab0 0%, #3498db 100%);
    padding: 5rem 0;
    color: white;
    text-align: center;
    position: relative;
}

.hero-content {
    position: relative;
    z-index: 2;
}

.hero-title {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
}

.hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    color: #f8f9fa;
    max-width: 650px;
    margin-left: auto;
    margin-right: auto;
}

/* Stats Section */
.stats-section {
    background: #f8f9fa;
    padding: 4rem 0;
}

.stat-card {
    text-align: center;
    padding: 2rem;
    background: white;
    border-radius: 1rem;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
    height: 100%;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(68, 122, 176, 0.15);
    border-color: var(--secondary-color);
}

.stat-icon {
    font-size: 2.5rem;
    color: var(--secondary-color);
    margin-bottom: 1rem;
}

.stat-number {
    font-size: 2.25rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #6c757d;
    font-weight: 500;
}

/* Features Section */
.features-section {
    background: #ffffff;
    padding: 5rem 0;
}

.section-title {
    text-align: center;
    margin-bottom: 3rem;
    color: var(--primary-color);
}

.section-title h2 {
    font-size: 2.25rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--primary-color);
}

.section-title p {
    color: #6c757d;
    font-size: 1rem;
    max-width: 600px;
    margin: 0 auto;
}

.feature-card {
    background: #f9fafb;
    border-radius: 1rem;
    padding: 2rem;
    height: 100%;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(68, 122, 176, 0.15);
    border-color: var(--secondary-color);
}

.feature-icon {
    font-size: 2rem;
    color: var(--secondary-color);
    margin-bottom: 1rem;
}

.feature-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.75rem;
}

.feature-description {
    color: #6c757d;
    line-height: 1.6;
}

/* Recent Section */
.recent-section {
    background: #f8f9fa;
    padding: 5rem 0;
}

.recent-card {
    background: white;
    border-radius: 0.75rem;
    padding: 1.5rem;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
    height: 100%;
}

.recent-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(68, 122, 176, 0.15);
    border-color: var(--secondary-color);
}

.recent-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
}

.recent-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
    flex: 1;
}

.recent-date {
    color: var(--secondary-color);
    font-size: 0.9rem;
    font-weight: 500;
}

.recent-meta {
    color: #6c757d;
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
}

.recent-description {
    color: #495057;
    font-size: 0.95rem;
    line-height: 1.5;
}

/* Quick Actions */
.quick-actions {
    background: #ffffff;
    padding: 4rem 0;
}

.action-card {
    background: #f9fafb;
    border-radius: 1rem;
    padding: 2rem;
    text-align: center;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
    height: 100%;
}

.action-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(68, 122, 176, 0.15);
    border-color: var(--secondary-color);
}

.action-icon {
    font-size: 2.5rem;
    color: var(--secondary-color);
    margin-bottom: 1.25rem;
}

.action-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.75rem;
}

.action-description {
    color: #6c757d;
    margin-bottom: 1rem;
}

/* Responsive */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2.25rem;
    }
    .hero-subtitle {
        font-size: 1rem;
    }
    .stat-number {
        font-size: 1.75rem;
    }
    .section-title h2 {
        font-size: 1.75rem;
    }
}

</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">Добро пожаловать в Библиотечную Систему</h1>
            <p class="hero-subtitle">Современная платформа для управления библиотечными ресурсами, студентами и книжными выдачами</p>
            <div class="d-flex gap-3 justify-content-center">
                <a href="{% url 'book_list' %}" class="btn btn-dark btn-lg">
                    <i class="fas fa-book me-2"></i>Каталог книг
                </a>
                {% if not user.is_authenticated %}
                <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg">
                    <i class="fas fa-sign-in-alt me-2"></i>Войти в систему
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="stats-section">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-number">{{ total_books|default:"0" }}</div>
                    <div class="stat-label">Всего книг</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-number">{{ total_students|default:"0" }}</div>
                    <div class="stat-label">Студентов</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="stat-number">{{ active_loans|default:"0" }}</div>
                    <div class="stat-label">Активных выдач</div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-number">{{ total_branches|default:"0" }}</div>
                    <div class="stat-label">Филиалов</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="features-section">
    <div class="container">
        <div class="section-title">
            <h2>Возможности системы</h2>
            <p>Современные инструменты для эффективного управления библиотекой</p>
        </div>
        
        <div class="row g-4">
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="feature-title">Управление книгами</h3>
                    <p class="feature-description">
                        Полный контроль над библиотечным каталогом: добавление, редактирование, поиск и категоризация книг.
                        Подробная информация об авторах, издательствах и доступности.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="feature-title">Учет студентов</h3>
                    <p class="feature-description">
                        Ведение базы данных студентов, привязка к факультетам, отслеживание истории выдачи книг.
                        Быстрый поиск и управление студенческими профилями.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <h3 class="feature-title">Система выдачи</h3>
                    <p class="feature-description">
                        Эффективное управление процессом выдачи и возврата книг. Автоматическое обновление инвентаря.
                        Отслеживание сроков возврата и уведомления о просрочках.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h3 class="feature-title">Отчетность</h3>
                    <p class="feature-description">
                        Детальная аналитика и отчеты: популярные книги, активные читатели, статистика по филиалам.
                        Визуализация данных для принятия informed решений.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h3 class="feature-title">Мультифилиальность</h3>
                    <p class="feature-description">
                        Поддержка нескольких библиотечных филиалов. Централизованное управление инвентарем
                        с распределением по локациям и отслеживанием доступности.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 class="feature-title">Доступность</h3>
                    <p class="feature-description">
                        Современный адаптивный интерфейс, работающий на любых устройствах.
                        Интуитивная навигация и быстрый доступ к ключевым функциям системы.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Recent Books Section -->
<section class="recent-section">
    <div class="container">
        <div class="section-title">
            <h2>Новые поступления</h2>
            <p>Свежие добавления в библиотечный каталог</p>
        </div>
        
        <div class="row g-4">
            {% for book in recent_books %}
            <div class="col-lg-4 col-md-6">
                <div class="recent-card">
                    <div class="recent-header">
                        <h4 class="recent-title">{{ book.title }}</h4>
                        <span class="recent-date">{{ book.publication_year }}</span>
                    </div>
                    <div class="recent-meta">
                        {% for author in book.authors.all|slice:":2" %}
                        <span class="me-2">{{ author }}</span>
                        {% endfor %}
                    </div>
                    <p class="recent-description">
                        {% if book.publisher %}
                        Издательство: {{ book.publisher.name }}
                        {% endif %}
                    </p>
                    <a href="{% url 'book_detail' book.pk %}" class="btn btn-sm btn-outline-primary mt-2">
                        Подробнее
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">Нет новых книг</p>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{% url 'book_list' %}" class="btn btn-primary">
                <i class="fas fa-book me-2"></i>Весь каталог
            </a>
        </div>
    </div>
</section>

<!-- Recent Loans Section -->
<section class="recent-section" >
    <div class="container">
        <div class="section-title">
            <h2>Последние выдачи</h2>
            <p>Недавняя активность в библиотеке</p>
        </div>
        
        <div class="row g-4">
            {% for loan in recent_loans %}
            <div class="col-lg-6">
                <div class="recent-card">
                    <div class="recent-header">
                        <h4 class="recent-title">{{ loan.book.title }}</h4>
                        <span class="recent-date">{{ loan.issue_date|date:"d.m.Y" }}</span>
                    </div>
                    <div class="recent-meta">
                        <span class="me-3">
                            <i class="fas fa-user-graduate me-1"></i>
                            {{ loan.student.get_full_name }}
                        </span>
                        <span>
                            <i class="fas fa-building me-1"></i>
                            {{ loan.branch.name }}
                        </span>
                    </div>
                    <p class="recent-description">
                        Статус: 
                        {% if loan.is_returned %}
                        <span class="text-success">Возвращена</span>
                        {% else %}
                        <span class="text-warning">На руках</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">Нет данных о выдачах</p>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{% url 'loan_list' %}" class="btn btn-primary">
                <i class="fas fa-exchange-alt me-2"></i>Все выдачи
            </a>
        </div>
    </div>
</section>

<!-- Quick Actions Section -->
<section class="quick-actions">
    <div class="container">
        <div class="section-title">
            <h2>Быстрые действия</h2>
            <p>Доступ к основным функциям системы</p>
        </div>
        
        <div class="row g-4">
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3 class="action-title">Новая выдача</h3>
                    <p class="action-description">
                        Оформить выдачу книги студенту
                    </p>
                    <a href="{% url 'loan_add' %}" class="btn btn-primary">
                        Оформить
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3 class="action-title">Поиск книг</h3>
                    <p class="action-description">
                        Найти книгу в каталоге
                    </p>
                    <a href="{% url 'inventory_query' %}" class="btn btn-primary">
                        Искать
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <h3 class="action-title">Отчеты</h3>
                    <p class="action-description">
                        Просмотр статистики и отчетов
                    </p>
                    <a href="{% url 'reports_dashboard' %}" class="btn btn-primary">
                        Смотреть
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Animate stats counting
    document.addEventListener('DOMContentLoaded', function() {
        const statElements = document.querySelectorAll('.stat-number');
        
        statElements.forEach(stat => {
            const target = parseInt(stat.textContent);
            let current = 0;
            const duration = 2000; // ms
            const steps = 60;
            const increment = target / steps;
            const stepTime = duration / steps;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    stat.textContent = target;
                    clearInterval(timer);
                } else {
                    stat.textContent = Math.round(current);
                }
            }, stepTime);
        });
    });
</script>
{% endblock %}
